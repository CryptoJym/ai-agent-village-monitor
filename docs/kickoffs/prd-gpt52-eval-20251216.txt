You are Opus Lead Orchestrator (“King”) running a 3-subagent sprint using Task Master.

Primary goal: PRD fidelity audit + gap plan (high detail), using the existing Task Master setup.

Repo:
- /Users/jamesbrady/Projects/utlyze/ai-agent-village/canonical/ai-agent-village-monitor

Hard rules:
- Do NOT run `task-master init`.
- Do NOT hand-edit `.taskmaster/**/*.json` (Task Master CLI only).
- Use PRs as approval gates: open PRs, request review, NEVER merge.
- Keep file boundaries: each subagent only touches its allowed paths.
- Update Task Master with “Audit/Plan/Progress/Done” notes.

Preflight (run first):
1) cd repo
2) gh auth status
3) task-master tags use prd-gpt52-eval-20251216
4) task-master validate-dependencies
5) task-master list

Context:
- PR #39 is ready to merge (execution-plane Task #4): https://github.com/CryptoJym/ai-agent-village-monitor/pull/39
- PR #40 adds the tag `prd-gpt52-eval-20251216` tasks generated from `.taskmaster/docs/prd.txt`:
  https://github.com/CryptoJym/ai-agent-village-monitor/pull/40

Mission (this sprint):
1) (If not already merged) ask the human to merge PR #39, then mark execution-plane Task #4 to review/done.
2) For tag `prd-gpt52-eval-20251216`, perform an “implemented vs partial vs missing” audit for Tasks #1–#15.
3) Update each Task Master task with:
   - Audit: status (implemented/partial/missing) + concrete file paths + test commands
   - Plan: next smallest step to close gaps (specific files + acceptance criteria)
4) Produce ONE consolidated doc deliverable:
   - docs/PRD_FIDELITY_TRACE_MATRIX.md
   - Format: Task ID → PRD section(s) → status (implemented/partial/missing) → code files → test files → notes.
5) Open a PR for the doc + Task Master status updates (no merges).

Parallel subagents (run concurrently):

Subagent A (Backend/DB/GitHub) — Tasks: 1–8
- Allowed paths: packages/server/**, packages/shared/**, docs/** (only for trace doc contributions)
- What to check:
  - Prisma schema/migrations exist for Village/House/Room/Agent/WorldMap
  - CRUD endpoints exist under /api/* (villages/houses/rooms/agents)
  - GitHub GraphQL wrapper + repo tree fetcher + webhook processing exist
  - Tests: locate vitest/jest usage, what’s passing/covered

Subagent B (Frontend/Game runtime) — Tasks: 9, 10, 14
- Allowed paths: packages/frontend/**, docs/** (only for trace doc contributions)
- What to check:
  - Phaser scene/camera system structure
  - Input handler + asset manifest system
  - Tilemap rendering + collision
  - Tests/typecheck commands and current status

Subagent C (Worldgen + Agents) — Tasks: 11–13, 15
- Allowed paths: packages/frontend/**, packages/shared/**, docs/** (only for trace doc contributions)
- What to check:
  - Prando seeded RNG + BSP generator
  - Delaunay triangulation + corridor generation
  - Auto-tiling + decorations + deterministic generation
  - XState v5 agent state machines and wiring

Per subagent workflow:
1) Create a branch:
   - A: prd-audit-backend-20251216
   - B: prd-audit-frontend-20251216
   - C: prd-audit-worldgen-20251216
2) Audit assigned tasks; do not “invent” implementation—only claim what exists.
3) For each assigned task ID:
   - task-master update-task --append <id> "Audit: ... (file paths + tests)"
   - If missing/partial: task-master update-task --append <id> "Plan: next step ..."
   - If clearly implemented: task-master set-status --id=<id> --status=review
4) Commit changes (docs + Task Master artifacts only), push, open PR, request review.

Lead (King) responsibilities:
- Ensure the consolidated trace doc is consistent and merged into a single PR (rebase/merge PRs as needed, but do not merge into main).
- Post a final summary: what’s implemented vs missing; top 5 gaps; recommended next 2-week execution plan.
